<!-- src/app/features/dashboard/process-kpis/process-kpis.component.html -->
<div class="process-kpis-container">
  <!-- Header -->
  <div class="page-header">
    <h1><i class="bi bi-calculator"></i> Process KPIs - Cálculos Agronómicos</h1>
  </div>

  <button type="button" class="btn btn-secondary me-2" (click)="goToDashboard()">
    <i class="bi bi-arrow-left"></i>
    Regresar al Dashboard
  </button>

  <br />
  <br />

  <!-- Filter Form -->
  <div class="filter-section card">
    <div class="card-header">
      <h5><i class="bi bi-filter"></i> Filtros de Cálculo</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="filterForm" (ngSubmit)="calculateKPIs()">
        <div class="row">
          <!-- Crop Production Selection -->
          <div class="col-md-3">
            <label class="form-label">Producción de Cultivo *</label>
            <select class="form-select" formControlName="cropProductionId">
              <option [value]="null">Seleccione...</option>
              <option *ngFor="let cp of cropProductions" [value]="cp.id">
                {{ cp.name }}
              </option>
            </select>
          </div>

          <!-- Start Date -->
          <div class="col-md-3">
            <label class="form-label">Fecha Inicio *</label>
            <input type="date" class="form-control" formControlName="startDate" />
          </div>

          <!-- End Date -->
          <div class="col-md-3">
            <label class="form-label">Fecha Fin *</label>
            <input type="date" class="form-control" formControlName="endDate" />
          </div>

          <!-- Calculate Button -->
          <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100" [disabled]="isCalculating || filterForm.invalid">
              <span *ngIf="!isCalculating">
                <i class="bi bi-play-circle"></i> Calcular KPIs
              </span>
              <span *ngIf="isCalculating">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Calculando...
              </span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show">
    <i class="bi bi-exclamation-triangle"></i> {{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3">Cargando datos...</p>
  </div>

  <!-- KPI Results -->
  <div *ngIf="kpiData.length > 0 && !isLoading" class="kpi-results">

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4">
      <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">
          <i class="bi bi-grid"></i> Resumen
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'climate'" (click)="setActiveTab('climate')">
          <i class="bi bi-cloud-sun"></i> KPIs Climáticos
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'irrigation'" (click)="setActiveTab('irrigation')">
          <i class="bi bi-droplet"></i> KPIs Riego
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" [class.active]="activeTab === 'crop'" (click)="setActiveTab('crop')">
          <i class="bi bi-flower1"></i> KPIs Cultivo
        </a>
      </li>
    </ul>

    <!-- Overview Tab -->
    <div *ngIf="activeTab === 'overview'" class="tab-content">
      <div class="row mb-4">
        <!-- Summary Cards -->
        <div class="col-md-3">
          <div class="stat-card stat-card-primary">
            <div class="stat-icon">
              <i class="bi bi-calendar-range"></i>
            </div>
            <div class="stat-info">
              <h3>{{ kpiData.length }}</h3>
              <p>Días Analizados</p>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="stat-card stat-card-success">
            <div class="stat-icon">
              <i class="bi bi-droplet-half"></i>
            </div>
            <div class="stat-info">
              <h3>{{ getAverageET() | number:'1.2-2' }}</h3>
              <p>ET Promedio (mm/día)</p>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="stat-card stat-card-warning">
            <div class="stat-icon">
              <i class="bi bi-thermometer-half"></i>
            </div>
            <div class="stat-info">
              <h3>{{ getTotalDegreesDay() | number:'1.0-0' }}</h3>
              <p>Grados Día Acumulados</p>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="stat-card stat-card-info">
            <div class="stat-icon">
              <i class="bi bi-water"></i>
            </div>
            <div class="stat-info">
              <h3>{{ getTotalIrrigationVolume() | number:'1.0-0' }}</h3>
              <p>Volumen Riego Total (L)</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Daily KPIs Table -->
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5><i class="bi bi-table"></i> KPIs Diarios</h5>
          <button class="btn btn-sm btn-outline-primary" (click)="exportToCSV()">
            <i class="bi bi-download"></i> Exportar CSV
          </button>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>ET Ref (mm/día)</th>
                  <th>VPD (kPa)</th>
                  <th>Grados Día</th>
                  <th>Radiación Neta (MJ/m²/día)</th>
                  <th>Vol. Riego (L)</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let kpi of kpiData">
                  <td>{{ kpi.date | date:'shortDate' }}</td>
                  <td>{{ kpi.climate.referenceET | number:'1.2-2' }}</td>
                  <td>{{ kpi.climate.vaporPressureDeficit | number:'1.2-2' }}</td>
                  <td>{{ kpi.climate.degreesDay | number:'1.1-1' }}</td>
                  <td>{{ kpi.climate.netRadiation | number:'1.2-2' }}</td>
                  <td>{{ kpi.irrigation.totalVolume | number:'1.0-0' }}</td>
                  <td>
                    <button class="btn btn-sm btn-outline-info" (click)="viewDayDetails(kpi)">
                      <i class="bi bi-eye"></i> Ver Detalles
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Climate Tab -->
    <div *ngIf="activeTab === 'climate'" class="tab-content">
      <div class="row">
        <div class="col-12 mb-3">
          <h5><i class="bi bi-cloud-sun"></i> KPIs Climáticos Detallados</h5>
          <p class="text-muted">Cálculos basados en FAO-56 Penman-Monteith</p>
        </div>

        <div *ngFor="let kpi of kpiData" class="col-md-6 col-lg-4 mb-3">
          <div class="card kpi-card">
            <div class="card-header bg-primary text-white">
              <strong>{{ kpi.date | date:'shortDate' }}</strong>
            </div>
            <div class="card-body">
              <div class="kpi-row">
                <span class="kpi-label">ET Referencia:</span>
                <span class="kpi-value">{{ kpi.climate.referenceET | number:'1.2-2' }} mm/día</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">VPD:</span>
                <span class="kpi-value">{{ kpi.climate.vaporPressureDeficit | number:'1.2-2' }} kPa</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Presión Vapor Sat:</span>
                <span class="kpi-value">{{ kpi.climate.saturationVaporPressure | number:'1.2-2' }} kPa</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Radiación Extraterrestre:</span>
                <span class="kpi-value">{{ kpi.climate.extraterrestrialRadiation | number:'1.2-2' }} MJ/m²/día</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Radiación Cielo Claro:</span>
                <span class="kpi-value">{{ kpi.climate.clearSkySolarRadiation | number:'1.2-2' }} MJ/m²/día</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Radiación Neta:</span>
                <span class="kpi-value">{{ kpi.climate.netRadiation | number:'1.2-2' }} MJ/m²/día</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Grados Día:</span>
                <span class="kpi-value">{{ kpi.climate.degreesDay | number:'1.1-1' }} °C·día</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Constante Psicrométrica:</span>
                <span class="kpi-value">{{ kpi.climate.psychrometricConstant | number:'1.3-3' }} kPa/°C</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Irrigation Tab -->
    <div *ngIf="activeTab === 'irrigation'" class="tab-content">
      <div class="row">
        <div class="col-12 mb-3">
          <h5><i class="bi bi-droplet"></i> KPIs de Riego</h5>
          <p class="text-muted">Métricas de riego y volúmenes aplicados</p>
        </div>

        <div *ngFor="let kpi of kpiData" class="col-md-6 col-lg-4 mb-3">
          <div class="card kpi-card">
            <div class="card-header bg-info text-white">
              <strong>{{ kpi.date | date:'shortDate' }}</strong>
            </div>
            <div class="card-body">
              <div class="kpi-row">
                <span class="kpi-label">Volumen Total:</span>
                <span class="kpi-value">{{ kpi.irrigation.totalVolume | number:'1.0-0' }} L</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Duración:</span>
                <span class="kpi-value">{{ kpi.irrigation.totalDuration | number:'1.0-0' }} min</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">% Drenaje Promedio:</span>
                <span class="kpi-value">{{ kpi.irrigation.averageDrainPercentage | number:'1.1-1' }}%</span>
              </div>
              <div class="kpi-row">
                <span class="kpi-label">Eventos de Riego:</span>
                <span class="kpi-value">{{ kpi.irrigation.metrics.length }}</span>
              </div>
              <div *ngIf="kpi.cropEvapoTranspiration" class="kpi-row highlight">
                <span class="kpi-label">ET Cultivo:</span>
                <span class="kpi-value">{{ kpi.cropEvapoTranspiration | number:'1.2-2' }} mm/día</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Crop Tab -->
    <div *ngIf="activeTab === 'crop'" class="tab-content">
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h5><i class="bi bi-flower1"></i> Información del Cultivo</h5>
            </div>
            <div class="card-body">
              <div *ngIf="kpiData.length > 0" class="kpi-details">
                <div class="kpi-row">
                  <span class="kpi-label">Área Total:</span>
                  <span class="kpi-value">{{ kpiData[0].crop.area | number:'1.2-2' }} m²</span>
                </div>
                <div class="kpi-row">
                  <span class="kpi-label">Densidad Plantas:</span>
                  <span class="kpi-value">{{ kpiData[0].crop.densityPlant | number:'1.2-2' }} plantas/m²</span>
                </div>
                <div class="kpi-row">
                  <span class="kpi-label">Densidad Contenedores:</span>
                  <span class="kpi-value">{{ kpiData[0].crop.densityContainer | number:'1.2-2' }} cont/m²</span>
                </div>
                <div class="kpi-row">
                  <span class="kpi-label">Total Plantas:</span>
                  <span class="kpi-value">{{ kpiData[0].crop.totalPlants | number:'1.0-0' }}</span>
                </div>
                <div class="kpi-row">
                  <span class="kpi-label">Número de Hileras:</span>
                  <span class="kpi-value">{{ kpiData[0].crop.numberOfRows }}</span>
                </div>
                <div class="kpi-row">
                  <span class="kpi-label">Latitud:</span>
                  <span class="kpi-value">{{ kpiData[0].crop.latitudeGrades }}° {{ kpiData[0].crop.latitudeMinutes
                    }}'</span>
                </div>
                <div *ngIf="kpiData[0].crop.containerVolume" class="kpi-row">
                  <span class="kpi-label">Volumen Contenedor:</span>
                  <span class="kpi-value">{{ kpiData[0].crop.containerVolume.value | number:'1.2-2' }} L</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-warning text-dark">
              <h5><i class="bi bi-moisture"></i> Medio de Crecimiento</h5>
            </div>
            <div class="card-body">
              <div *ngIf="kpiData.length > 0" class="kpi-details">
                <div class="kpi-row">
                  <span class="kpi-label">Agua Total Disponible:</span>
                  <span class="kpi-value">{{ kpiData[0].growingMedium.totalAvailableWaterPercentage | number:'1.1-1'
                    }}%</span>
                </div>
                <div class="kpi-row">
                  <span class="kpi-label">Agua Fácilmente Disponible:</span>
                  <span class="kpi-value">{{ kpiData[0].growingMedium.easelyAvailableWaterPercentage | number:'1.1-1'
                    }}%</span>
                </div>
                <div class="kpi-row">
                  <span class="kpi-label">Agua de Reserva:</span>
                  <span class="kpi-value">{{ kpiData[0].growingMedium.reserveWaterPercentage | number:'1.1-1' }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="kpiData.length === 0 && !isLoading && !isCalculating" class="empty-state">
    <i class="bi bi-calculator-fill"></i>
    <h3>No hay datos calculados</h3>
    <p>Seleccione los filtros y presione "Calcular KPIs" para generar los resultados</p>
  </div>

</div>

<!-- Detail Modal -->
<div class="modal fade" [class.show]="showDetailModal" [style.display]="showDetailModal ? 'block' : 'none'">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" *ngIf="selectedDayKPI">
      <div class="modal-header bg-gradient-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-info-circle-fill"></i> Detalles Completos KPI - {{ selectedDayKPI.date | date:'fullDate' }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeDetailModal()"></button>
      </div>
      <div class="modal-body">

        <!-- Climate KPIs Section -->
        <div class="detail-section mb-4">
          <h6 class="section-title">
            <i class="bi bi-cloud-sun text-primary"></i> KPIs Climáticos
          </h6>
          <div class="row">
            <div class="col-md-6">
              <div class="detail-group">
                <h6 class="detail-group-title">Evapotranspiración</h6>
                <div class="detail-item">
                  <span class="detail-label">ET Referencia (FAO-56):</span>
                  <span class="detail-value text-primary">{{ selectedDayKPI.climate.referenceET | number:'1.3-3' }}
                    mm/día</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Grados Día:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.degreesDay | number:'1.2-2' }} °C·día</span>
                </div>
              </div>

              <div class="detail-group">
                <h6 class="detail-group-title">Presión de Vapor</h6>
                <div class="detail-item">
                  <span class="detail-label">Presión Vapor Saturación:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.saturationVaporPressure | number:'1.3-3' }}
                    kPa</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Presión Vapor Real:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.realVaporPressure | number:'1.3-3' }} kPa</span>
                </div>
                <div class="detail-item highlight">
                  <span class="detail-label">Déficit Presión Vapor (VPD):</span>
                  <span class="detail-value text-danger">{{ selectedDayKPI.climate.vaporPressureDeficit | number:'1.3-3'
                    }} kPa</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="detail-group">
                <h6 class="detail-group-title">Radiación Solar</h6>
                <div class="detail-item">
                  <span class="detail-label">Radiación Extraterrestre:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.extraterrestrialRadiation | number:'1.2-2' }}
                    MJ/m²/día</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Radiación Cielo Claro:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.clearSkySolarRadiation | number:'1.2-2' }}
                    MJ/m²/día</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Radiación Solar Neta:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.netSolarRadiation | number:'1.2-2' }}
                    MJ/m²/día</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Radiación Longwave Neta:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.netLongwaveRadiation | number:'1.2-2' }}
                    MJ/m²/día</span>
                </div>
                <div class="detail-item highlight">
                  <span class="detail-label">Radiación Neta Total:</span>
                  <span class="detail-value text-success">{{ selectedDayKPI.climate.netRadiation | number:'1.2-2' }}
                    MJ/m²/día</span>
                </div>
              </div>

              <div class="detail-group">
                <h6 class="detail-group-title">Constantes Atmosféricas</h6>
                <div class="detail-item">
                  <span class="detail-label">Constante Psicrométrica:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.psychrometricConstant | number:'1.4-4' }}
                    kPa/°C</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Pendiente Curva Presión Vapor:</span>
                  <span class="detail-value">{{ selectedDayKPI.climate.slopeVaporPressureCurve | number:'1.4-4' }}
                    kPa/°C</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <hr>

        <!-- Irrigation KPIs Section -->
        <div class="detail-section mb-4">
          <h6 class="section-title">
            <i class="bi bi-droplet-fill text-info"></i> KPIs de Riego
          </h6>
          <div class="row">
            <div class="col-md-4">
              <div class="detail-group">
                <h6 class="detail-group-title">Volúmenes</h6>
                <div class="detail-item">
                  <span class="detail-label">Volumen Total Aplicado:</span>
                  <span class="detail-value text-info">{{ selectedDayKPI.irrigation.totalVolume | number:'1.1-1' }}
                    L</span>
                </div>
                <div class="detail-item" *ngIf="selectedDayKPI.cropEvapoTranspiration">
                  <span class="detail-label">ET Cultivo:</span>
                  <span class="detail-value">{{ selectedDayKPI.cropEvapoTranspiration | number:'1.2-2' }} mm/día</span>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="detail-group">
                <h6 class="detail-group-title">Duración</h6>
                <div class="detail-item">
                  <span class="detail-label">Tiempo Total Riego:</span>
                  <span class="detail-value">{{ selectedDayKPI.irrigation.totalDuration | number:'1.0-0' }}
                    minutos</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Eventos de Riego:</span>
                  <span class="detail-value">{{ selectedDayKPI.irrigation.metrics.length }}</span>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="detail-group">
                <h6 class="detail-group-title">Eficiencia</h6>
                <div class="detail-item">
                  <span class="detail-label">% Drenaje Promedio:</span>
                  <span class="detail-value"
                    [class.text-success]="selectedDayKPI.irrigation.averageDrainPercentage < 20"
                    [class.text-warning]="selectedDayKPI.irrigation.averageDrainPercentage >= 20 && selectedDayKPI.irrigation.averageDrainPercentage < 30"
                    [class.text-danger]="selectedDayKPI.irrigation.averageDrainPercentage >= 30">
                    {{ selectedDayKPI.irrigation.averageDrainPercentage | number:'1.1-1' }}%
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <hr>

        <!-- Crop Production KPIs Section -->
        <div class="detail-section mb-4">
          <h6 class="section-title">
            <i class="bi bi-flower1 text-success"></i> Información del Cultivo
          </h6>
          <div class="row">
            <div class="col-md-6">
              <div class="detail-group">
                <h6 class="detail-group-title">Dimensiones</h6>
                <div class="detail-item">
                  <span class="detail-label">Área Total:</span>
                  <span class="detail-value">{{ selectedDayKPI.crop.area | number:'1.2-2' }} m²</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Número de Hileras:</span>
                  <span class="detail-value">{{ selectedDayKPI.crop.numberOfRows }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Coordenadas:</span>
                  <span class="detail-value">{{ selectedDayKPI.crop.latitudeGrades }}° {{
                    selectedDayKPI.crop.latitudeMinutes }}'</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="detail-group">
                <h6 class="detail-group-title">Densidades y Plantas</h6>
                <div class="detail-item">
                  <span class="detail-label">Densidad Plantas:</span>
                  <span class="detail-value">{{ selectedDayKPI.crop.densityPlant | number:'1.2-2' }} plantas/m²</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Densidad Contenedores:</span>
                  <span class="detail-value">{{ selectedDayKPI.crop.densityContainer | number:'1.2-2' }} cont/m²</span>
                </div>
                <div class="detail-item highlight">
                  <span class="detail-label">Total Plantas:</span>
                  <span class="detail-value text-success">{{ selectedDayKPI.crop.totalPlants | number:'1.0-0' }}</span>
                </div>
                <div class="detail-item" *ngIf="selectedDayKPI.crop.containerVolume">
                  <span class="detail-label">Volumen Contenedor:</span>
                  <span class="detail-value">{{ selectedDayKPI.crop.containerVolume.value | number:'1.2-2' }} L</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <hr>

        <!-- Growing Medium KPIs Section -->
        <div class="detail-section">
          <h6 class="section-title">
            <i class="bi bi-moisture text-warning"></i> Medio de Crecimiento - Balance Hídrico
          </h6>
          <div class="row">
            <div class="col-md-4">
              <div class="water-gauge">
                <div class="gauge-label">Agua Total Disponible</div>
                <div class="gauge-value">{{ selectedDayKPI.growingMedium.totalAvailableWaterPercentage | number:'1.1-1'
                  }}%</div>
                <div class="gauge-bar">
                  <div class="gauge-fill bg-info"
                    [style.width.%]="selectedDayKPI.growingMedium.totalAvailableWaterPercentage"></div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="water-gauge">
                <div class="gauge-label">Agua Fácilmente Disponible</div>
                <div class="gauge-value">{{ selectedDayKPI.growingMedium.easelyAvailableWaterPercentage | number:'1.1-1'
                  }}%</div>
                <div class="gauge-bar">
                  <div class="gauge-fill bg-success"
                    [style.width.%]="selectedDayKPI.growingMedium.easelyAvailableWaterPercentage"></div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="water-gauge">
                <div class="gauge-label">Agua de Reserva</div>
                <div class="gauge-value">{{ selectedDayKPI.growingMedium.reserveWaterPercentage | number:'1.1-1' }}%
                </div>
                <div class="gauge-bar">
                  <div class="gauge-fill bg-warning"
                    [style.width.%]="selectedDayKPI.growingMedium.reserveWaterPercentage"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Water Balance Explanation -->
          <div class="alert alert-info mt-3" role="alert">
            <small>
              <strong>Balance Hídrico:</strong>
              El agua total disponible es la diferencia entre la capacidad del contenedor y el punto de marchitez
              permanente.
              El agua fácilmente disponible es la que las plantas pueden absorber sin estrés.
              El agua de reserva requiere mayor esfuerzo de las plantas para ser absorbida.
            </small>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="closeDetailModal()">
          <i class="bi bi-x-circle"></i> Cerrar
        </button>
        <button type="button" class="btn btn-primary" (click)="exportDayToJSON(selectedDayKPI)">
          <i class="bi bi-download"></i> Exportar JSON
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showDetailModal" *ngIf="showDetailModal"></div>